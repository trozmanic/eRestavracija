const svg =[`<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-emoji-angry" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path fill-rule="evenodd" d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683z"/>
  <path d="M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/>
  <path fill-rule="evenodd" d="M4.053 4.276a.5.5 0 0 1 .67-.223l2 1a.5.5 0 1 1-.447.894l-2-1a.5.5 0 0 1-.223-.67zm7.894 0a.5.5 0 0 0-.67-.223l-2 1a.5.5 0 1 0 .447.894l2-1a.5.5 0 0 0 .223-.67z"/>
</svg>`,
    `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-emoji-frown" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path fill-rule="evenodd" d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683z"/>
  <path d="M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/>
</svg>`,
    `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-emoji-neutral" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path fill-rule="evenodd" d="M4 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z"/>
  <path d="M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/>
</svg>`,
    `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-emoji-smile" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path fill-rule="evenodd" d="M4.285 9.567a.5.5 0 0 1 .683.183A3.498 3.498 0 0 0 8 11.5a3.498 3.498 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.498 4.498 0 0 1 8 12.5a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683z"/>
  <path d="M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/>
</svg>`,
    `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-emoji-laughing" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path fill-rule="evenodd" d="M12.331 9.5a1 1 0 0 1 0 1A4.998 4.998 0 0 1 8 13a4.998 4.998 0 0 1-4.33-2.5A1 1 0 0 1 4.535 9h6.93a1 1 0 0 1 .866.5z"/>
  <path d="M7 6.5c0 .828-.448 0-1 0s-1 .828-1 0S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 0-1 0s-1 .828-1 0S9.448 5 10 5s1 .672 1 1.5z"/>
</svg>`]
window.addEventListener('load', function () {

    var script = document.createElement('script');
    script.src = 'https://code.jquery.com/jquery-3.4.1.min.js';
    script.type = 'text/javascript';
    document.getElementsByTagName('head')[0].appendChild(script);
    // const $ = document.jQuery;



    console.log("Document loaded...");

    const slider = document.getElementById('myRange')
    const slider_change = function (event) {
        console.log ("Izbrana jed: " + chosen)
        const rating = slider.value;
        const number_container = document.getElementById('rating-number')
        const svg_container = document.getElementById("rating-svg")
        svg_container.innerHTML = svg[parseInt(rating) - 1]
        number_container.innerHTML = 'Ocena jedi: ' + rating
    }

    slider.addEventListener("input", slider_change);


    const isVisible = (classList) => {
        for (var i = 0; i < classList.length ; i ++) {
            if (classList[i] === 'hidden') {
                return false;
            }
        }
        return true;
    }

    let children = $(".card .card-img-top").get();
    let parents = $(".card").map(function() {
        return this.getAttribute("id");
    })
    let buttons = $(".card .button").get();

    //Global variable for chosen menuItem
    let chosen = null;

    buttons.forEach((button, index) => {
        button.addEventListener("click", () => {
            const id = parents[index];
            chosen = id;
        })
    })

    children.forEach((child, index) => {
        child.addEventListener("click", ()=> {
            const id = parents[index];
            const properties = document.getElementById("property-"+id);
            if (!isVisible(properties.classList)) {
                properties.classList.remove('hidden');
            }else {
                properties.classList.add('hidden');
            }
        })
    })

    const posljiOceno = document.getElementById("posljiOceno");
    posljiOceno.addEventListener("click", () => {
        const ocena = parseInt(slider.value);
        console.log ("Ocenil sme jed " + chosen + " z oceno " + ocena);
        if (!sessionStorage.getItem("credentials")) {
            return alert("Ce zelite uporabljati funkcinolanosti kot so ocenjevanje jedi se prosim prijavite oziroma" +
                " kreirajte uporabniski racun");
        }
        const uporabnik_id = JSON.parse (sessionStorage.getItem("credentials")).uporabnik_id;
        const obj = {
            id: chosen,
            ocena: ocena,
            id_uporabnika:uporabnik_id
        }
        $.ajax({
            url: '/api/meni/dodajOceno',
            type: 'POST',
            data: obj,
            success: function(data) {
                window.location.reload();
            }
        });
    })

    // var all = $(".card").map(function() {
    //     return this.innerHTML;
    // }).get();



    // for (var i = 1; i <= 8 ; i++) {
    //     var first_item = document.getElementById("card" + i);
    //     for (var j = 0; j < first_item.childNodes.length ; j ++) {
    //         const current_element = first_item.childNodes[j]
    //         if (current_element.classList != null && current_element.classList != undefined) {
    //             for (var z = 0 ; z < current_element.classList.length; z ++) {
    //                 if (current_element.classList[z] == 'card-img-top') {
    //                     first_item = current_element;
    //                     break;
    //                 }
    //             }
    //         }
    //
    //     }
    //     const first_property = document.getElementById("property" + i);
    //
    //     first_item.addEventListener("click", ()=> {
    //         console.log("click");
    //         if (!isVisible(first_property.classList)) {
    //             first_property.classList.remove('hidden');
    //         }else {
    //             first_property.classList.add('hidden');
    //         }
    //     })
    // }
})
